<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>YAK GAUNTLET SCOREBOARD</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 1rem;
      background: #f8f8f8;
      color: #333;
    }
    h1 {
      text-align: center;
    }
    form {
      max-width: 400px;
      margin: 0 auto 2rem;
      background: #fff;
      padding: 1rem;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgb(0 0 0 / 0.1);
    }
    label {
      display: block;
      margin-top: 1rem;
      font-weight: bold;
    }
    input[type="text"],
    input[type="date"],
    select {
      width: 100%;
      padding: 0.4rem;
      font-size: 1rem;
      margin-top: 0.3rem;
      box-sizing: border-box;
    }
    input[type="text"]:not(#divisionManual),
    input[type="date"],
    select {
      border: 1px solid #ccc;
      border-radius: 3px;
    }
    #divisionManual {
      margin-top: 0.5rem;
      padding: 0.3rem;
      border: 1px solid #666;
      border-radius: 3px;
      font-size: 1rem;
      width: calc(100% - 2px);
      display: none;
    }
    button {
      margin-top: 1.5rem;
      width: 100%;
      padding: 0.7rem;
      font-size: 1.1rem;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 3px;
      cursor: pointer;
    }
    button:hover {
      background: #218838;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 2px 5px rgb(0 0 0 / 0.1);
    }
    th, td {
      text-align: left;
      padding: 0.5rem;
      border-bottom: 1px solid #ddd;
    }
    th {
      background: #007bff;
      color: white;
    }
    tr:hover {
      background: #f1f1f1;
    }
  </style>
</head>
<body>
  <h1>YAK GAUNTLET SCOREBOARD</h1>

  <form id="scoreForm">
    <label for="name">Name</label>
    <input type="text" id="name" name="name" required />

    <label for="division">Division</label>
    <select id="division" name="division" required>
      <option value="" disabled selected>Select Division</option>
      <!-- divisions options dynamically populated -->
    </select>
    <input type="text" id="divisionManual" name="divisionManual" placeholder="Enter division" />

    <label for="category">Category</label>
    <select id="category" name="category" required>
      <option value="" disabled selected>Select Category</option>
      <!-- categories options dynamically populated -->
    </select>

    <label for="time">Time (seconds)</label>
    <input type="text" id="time" name="time" required pattern="^\d+(\.\d+)?$" title="Enter a valid time in seconds (e.g., 123.45)" />

    <label for="date">Date</label>
    <input type="date" id="date" name="date" required />

    <button type="submit">Add Entry</button>
  </form>

  <table id="scoreboard">
    <thead>
      <tr>
        <th>Rank</th>
        <th>Name</th>
        <th>Division</th>
        <th>Category</th>
        <th>Time</th>
        <th>Date</th>
      </tr>
    </thead>
    <tbody>
      <!-- entries will appear here -->
    </tbody>
  </table>

  <script>
    // Example data to start with
    let entries = [
      { name: "Alice", division: "Pro", category: "Speedrun", time: 120.5, date: "2025-05-27" },
      { name: "Bob", division: "Amateur", category: "Casual", time: 135.2, date: "2025-05-26" },
    ];

    const form = document.getElementById('scoreForm');
    const divisionSelect = document.getElementById('division');
    const divisionManualInput = document.getElementById('divisionManual');
    const categorySelect = document.getElementById('category');
    const scoreboardBody = document.querySelector('#scoreboard tbody');

    // Populate division and category selects dynamically
    function updateFilterOptions() {
      // Extract unique divisions and categories from entries
      const divisions = [...new Set(entries.map(e => e.division))].sort();
      const categories = [...new Set(entries.map(e => e.category))].sort();

      // Populate division select with options + "Other"
      divisionSelect.innerHTML =
        '<option value="" disabled selected>Select Division</option>' +
        divisions.map(d => `<option value="${d}">${d}</option>`).join('') +
        '<option value="Other">Other</option>';

      // Populate category select with options
      categorySelect.innerHTML =
        '<option value="" disabled selected>Select Category</option>' +
        categories.map(c => `<option value="${c}">${c}</option>`).join('');
    }

    // Render scoreboard table rows sorted by time ascending
    function renderScoreboard() {
      entries.sort((a, b) => a.time - b.time);
      scoreboardBody.innerHTML = entries.map((entry, index) => `
        <tr>
          <td>${index + 1}</td>
          <td>${entry.name}</td>
          <td>${entry.division}</td>
          <td>${entry.category}</td>
          <td>${entry.time.toFixed(2)}</td>
          <td>${entry.date}</td>
        </tr>
      `).join('');
    }

    // Toggle manual division input visibility when division changes
    divisionSelect.addEventListener('change', () => {
      if (divisionSelect.value === 'Other') {
        divisionManualInput.style.display = 'inline-block';
        divisionManualInput.required = true;
      } else {
        divisionManualInput.style.display = 'none';
        divisionManualInput.required = false;
        divisionManualInput.value = '';
      }
    });

    // Add new entry handler
    form.addEventListener('submit', (e) => {
      e.preventDefault();

      const name = document.getElementById('name').value.trim();
      let division = divisionSelect.value;
      const category = categorySelect.value;
      const timeStr = document.getElementById('time').value.trim();
      const dateInput = document.getElementById('date').value;

      // Use manual division if "Other" selected
      if (division === 'Other') {
        division = divisionManualInput.value.trim();
      }

      // Validate inputs
      if (!name || !division || !category || !timeStr || !dateInput) {
        alert('Please fill in all fields.');
        return;
      }

      const time = parseFloat(timeStr);
      if (isNaN(time) || time <= 0) {
        alert('Please enter a valid positive number for time.');
        return;
      }

      // Correct date to avoid timezone issues
      const dateRaw = new Date(dateInput);
      const correctedDate = new Date(dateRaw.getTime() + Math.abs(dateRaw.getTimezoneOffset() * 60000));
      const dateString = correctedDate.toISOString().split('T')[0];

      // Add the new entry
      entries.push({ name, division, category, time, date: dateString });

      // Reset form
      form.reset();
      divisionManualInput.style.display = 'none';
      divisionManualInput.required = false;

      // Update selects and scoreboard
      updateFilterOptions();
      renderScoreboard();
    });

    // Initialize on page load
    updateFilterOptions();
    renderScoreboard();
  </script>
</body>
</html>
